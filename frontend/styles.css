/* Visual-only subset copied from main styles to keep exact design */
:root{
  --bg:#0b0b0d; --panel:#131317; --muted:#101016; --text:#e6e6ec; --subtle:#a6a6b3; --primary:#7c5cff; --accent:#00d4ff;
  --glass: rgba(255,255,255,0.04);
  --glass-border: rgba(255,255,255,0.08);
  --shadow: 0 10px 34px rgba(0,0,0,0.55);
}
*{box-sizing:border-box}
html,body,#app{height:100%}
body{margin:0;background:radial-gradient(1200px 800px at 80% -20%,rgba(124,92,255,.15),transparent),linear-gradient(180deg,#0b0b0d 0%, #0b0b0d 100%);color:var(--text);font:14px/1.5 Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}

/* Node Board */
#nodeBoard{position:relative;width:100%;z-index:20;padding:14px 16px 6px 16px;backdrop-filter:blur(2px);height:auto;overflow:visible}
#nodeBoard .nb-sections{display:grid;grid-template-columns:repeat(3,minmax(240px,1fr));gap:12px;padding-right:6px}
#nodeBoard .nb-sec{position:relative;border:1px solid rgba(255,255,255,0.08);border-radius:10px;padding:8px 8px 12px;background:rgba(0,0,0,0.25)}
#nodeBoard .nb-title{font-weight:600;letter-spacing:.2px;margin:2px 0 8px 4px}
#nodeBoard .nb-grid{position:relative;height:320px;min-height:320px;background-image:linear-gradient(to right, rgba(255,255,255,0.05) 1px, transparent 1px),linear-gradient(to bottom, rgba(255,255,255,0.05) 1px, transparent 1px);background-size:24px 100%, 100% 24px;border-radius:8px}
#nodeBoard .nb-grid::after{content:"";position:absolute;left:0;right:0;bottom:0;height:2px;background:linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.12) 15%, rgba(255,255,255,0.12) 85%, transparent 100%);border-bottom-left-radius:8px;border-bottom-right-radius:8px;pointer-events:none}

.layout{overflow:auto;padding:0 18px 96px}
.content{padding:16px 0 96px}
.panel{position:relative;z-index:2000;border:1px solid #23232b;background:linear-gradient(180deg,#121219,#0e0e14);border-radius:12px;box-shadow:var(--shadow);margin-bottom:12px}
.panel .head{display:flex;align-items:baseline;gap:10px;padding:10px 52px 10px 12px;border-bottom:1px solid #23232b;position:relative}
.panel .head h2{margin:0;font-size:16px}
.panel .body{padding:12px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media (max-width:900px){.grid{grid-template-columns:1fr}}

/* Section IO point */
.panel .head .section-io{margin-left:auto;position:absolute;right:12px;top:50%;transform:translateY(-50%);display:inline-block;width:12px;height:12px;border-radius:50%;background:radial-gradient(circle at 30% 30%, #fff, #cde, #79f);border:2px solid #22c55e;box-shadow:0 0 8px rgba(34,197,94,0.6);z-index:9050;cursor:crosshair}
.panel .head .section-io.hover{border-color:#00d4ff;box-shadow:0 0 10px rgba(0,212,255,0.6)}
.panel .head .section-io:hover::after{content:'Input'; position:absolute; top:-26px; left:50%; transform:translateX(-50%); background:linear-gradient(180deg,#14141a,#0f0f13); border:1px solid #2a2a35; color:#cfd3e3; font-size:11px; padding:3px 6px; border-radius:6px; white-space:nowrap; pointer-events:none; box-shadow:0 8px 20px rgba(0,0,0,0.45); z-index:9100}

/* Buttons */
.btn{background:var(--glass);backdrop-filter:blur(6px);border:1px solid var(--glass-border);color:var(--text);padding:8px 10px;border-radius:10px;cursor:pointer}
.copilot-plus{position:fixed;left:50%;top:12px;transform:translateX(-50%);z-index:7000;width:40px;height:40px;border-radius:999px;border:1px dashed #2a2a35;background:#0f0f14;color:#cfd3e3;box-shadow:var(--shadow);cursor:pointer}
.copilot-plus:hover{border-color:#3a3a45}

/* Add-node dropdown wrapper/menu */
.copilot-plus-wrap{position:fixed;left:50%;top:12px;transform:translateX(-50%);z-index:7050}
/* Ensure the button inside wrapper is positioned relative to wrapper for menu placement */
.copilot-plus-wrap .copilot-plus{position:static;transform:none}
.add-menu{position:absolute;top:46px;left:50%;transform:translateX(-50%);display:grid;gap:6px;min-width:180px;padding:6px;background:linear-gradient(180deg,#121219,#0e0e14);border:1px solid #23232b;border-radius:10px;box-shadow:0 12px 28px rgba(0,0,0,0.55);z-index:7060}
.add-menu.hidden{display:none}
.add-menu button{appearance:none;background:rgba(255,255,255,0.03);border:1px solid #2a2a35;color:#e6e6ec;padding:8px 10px;border-radius:8px;text-align:left;cursor:pointer}
.add-menu button:hover{background:rgba(124,92,255,0.08);border-color:#3a3a45}
/* Generic hidden helper (used elsewhere too) */
.hidden{display:none !important}

/* FAB icons (User, CoWorker, Internet) */
.fab{position:absolute;z-index:9000;border-radius:999px;padding:10px 12px;min-width:48px;min-height:48px;background:linear-gradient(135deg,#14141a,#111116);color:var(--text);border:1px solid #23232b;box-shadow:var(--shadow);cursor:grab;display:inline-flex;align-items:center;justify-content:center;user-select:none;touch-action:none}
.fab *{pointer-events:none}
.fab .conn-point{pointer-events:auto}
.fab:active{cursor:grabbing}
.fab .hex-mini{width:20px;height:20px;display:block;filter:drop-shadow(0 2px 8px rgba(124,92,255,0.25))}
.fab-label{position:absolute;left:50%;top:-28px;transform:translateX(-50%);white-space:nowrap;padding:4px 8px;border-radius:8px;background:linear-gradient(180deg, rgba(124,92,255,0.06), rgba(0,212,255,0.03));color:#eaf6ff;font-weight:600;font-size:12px;box-shadow:0 6px 20px rgba(0,212,255,0.06);text-shadow:0 2px 10px rgba(124,92,255,0.18);pointer-events:none}
.globe-grid{display:block;filter:drop-shadow(0 0 10px rgba(0,212,255,0.25)) drop-shadow(0 0 20px rgba(124,92,255,0.18))}
.hex-avatar{position:relative;width:20px;height:20px;display:grid;place-items:center}
.hex-avatar svg{width:100%;height:100%;display:block;margin:auto;filter:drop-shadow(0 4px 14px rgba(124,92,255,0.25))}
.user-dot{width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,#0ea5e9,#34d399)}
.icon-btn{background:transparent;border:0;color:#a6a6b3;cursor:pointer}
.btn.btn-ghost{background:transparent;border:1px solid #2a2a35;color:#cfd3e3;padding:6px 10px;border-radius:8px}
.btn.danger{background:linear-gradient(135deg,#7c0000,#b01818);border:0;color:#fff;padding:6px 12px;border-radius:8px}
.brand{font-weight:700;letter-spacing:.5px;opacity:.9}
.drawer-head .brand{display:flex;align-items:center;gap:8px}
.note{color:#a6a6b3}
/* Editable section note UX */
.panel .body .note[contenteditable="true"]{min-height:160px;padding:8px;border:1px dashed #2a2a35;border-radius:8px}
.panel .body .note[contenteditable="true"]:focus{outline:1px solid #2a2a35;border-color:#3a3a45}

/* Glow/busy */
.fab.busy{box-shadow:0 0 0 2px rgba(124,92,255,0.75),0 0 22px rgba(124,92,255,0.35),0 0 44px rgba(0,212,255,0.25);border-color:rgba(124,92,255,0.6);animation:glowPulse 1.2s ease-in-out infinite}
@keyframes glowPulse{0%{box-shadow:0 0 0 2px rgba(124,92,255,0.65),0 0 18px rgba(124,92,255,0.28),0 0 36px rgba(0,212,255,0.2)}50%{box-shadow:0 0 0 2px rgba(124,92,255,0.9),0 0 30px rgba(124,92,255,0.45),0 0 60px rgba(0,212,255,0.35)}100%{box-shadow:0 0 0 2px rgba(124,92,255,0.65),0 0 18px rgba(124,92,255,0.28),0 0 36px rgba(0,212,255,0.2)}}

/* Connection layer */
svg#connLayer{position:fixed;inset:0;width:100vw;height:100vh;pointer-events:auto;z-index:1000}

/* Conn points on fabs and panels */
.conn-point{position:absolute;width:10px;height:10px;border-radius:50%;background:radial-gradient(circle at 30% 30%, #fff, #cde, #79f);border:2px solid #4a79ff;box-shadow:0 0 6px rgba(74,121,255,0.35);transform:translate(-50%, -50%);cursor:crosshair;z-index:10}
.conn-point.io-in{border-color:#22c55e;box-shadow:0 0 8px rgba(34,197,94,0.6)}
.conn-point.io-out{border-color:#8b5cf6;box-shadow:0 0 8px rgba(139,92,246,0.6)}
.conn-point.hover{border-color:#00d4ff;box-shadow:0 0 10px rgba(0,212,255,0.6)}
.conn-point:hover::after{
  position:absolute; top:-26px; left:50%; transform:translateX(-50%);
  background:linear-gradient(180deg,#14141a,#0f0f13);
  border:1px solid #2a2a35; color:#cfd3e3; font-size:11px;
  padding:3px 6px; border-radius:6px; white-space:nowrap; pointer-events:none;
  box-shadow:0 8px 20px rgba(0,0,0,0.45); z-index:7700;
}
.conn-point.io-in:hover::after{ content:'Input'; }
.conn-point.io-out:hover::after{ content:'Output'; }

/* Flyout chat panel (visual only) */
.panel-flyout{position:fixed;z-index:10020;max-width:92vw;max-height:85vh;display:flex;flex-direction:column;background:linear-gradient(180deg,var(--panel),#0f0f13);border:1px solid #23232b;border-radius:12px;box-shadow:0 18px 48px rgba(0,0,0,0.6);opacity:0;transform:scale(.85);transition:opacity .22s ease, transform .22s cubic-bezier(.18,.7,.2,1.02);pointer-events:none}
.panel-flyout{min-width:280px;min-height:200px}
.panel-flyout.show{opacity:1;transform:scale(1);pointer-events:auto}
.panel-flyout .drawer-head{display:flex;align-items:center;gap:10px;padding:12px;border-bottom:1px solid #23232b;cursor:move}
.panel-flyout .messages{padding:14px;overflow:auto;flex:1}
.panel-flyout .composer{display:flex;gap:8px;padding:14px;background:linear-gradient(180deg,#0f0f13,#0c0c10);border-top:1px solid #23232b;border-bottom-left-radius:12px;border-bottom-right-radius:12px}
.user-node-panel .messages,.user-node-panel .composer{font-family:var(--user-font, inherit)}
.panel-flyout .settings{display:grid;grid-template-columns:1fr;gap:10px;padding:12px;border-bottom:1px solid #23232b;background:linear-gradient(180deg,#101017,#0d0d13);max-height:calc(100% - 180px);overflow:auto}
.panel-flyout .settings.collapsed{display:none}
.panel-flyout label{display:flex;flex-direction:column;gap:6px;font-size:12px;color:#cfd3e3}
.panel-flyout label.inline{flex-direction:row;align-items:center;gap:8px}
.panel-flyout .color-field{display:flex;align-items:center;gap:10px}
.panel-flyout .color-toggle{width:22px;height:22px;border-radius:6px;border:1px solid #2a2a35;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.25);background:#7c5cff}
.panel-flyout .color-panel{position:relative}
.panel-flyout .color-panel input[type="color"]{width:34px;height:26px;border:1px solid #2a2a35;border-radius:6px;padding:0;background:#0f0f14}
.panel-flyout .color-panel.collapsed{display:none}
.panel-flyout select,.panel-flyout input[type="text"],.panel-flyout input[type="password"],.panel-flyout input[type="number"],.panel-flyout textarea{background:#0f0f14;border:1px solid #24242c;border-radius:10px;color:#e6e6ec;padding:8px 10px}
.panel-flyout input[type="range"]{width:100%}
.panel-flyout fieldset.subsec{border:1px dashed #2a2a35;border-radius:10px;padding:8px 10px}
.panel-flyout fieldset.subsec legend{padding:0 6px;color:#aab}
.badge{display:inline-flex;align-items:center;gap:6px;padding:2px 8px;border-radius:999px;border:1px solid #2a2a35;background:rgba(255,255,255,0.04);color:#dfe3f3;font-size:11px}
.badge-error{border-color:#673232;background:rgba(255,80,80,0.08);color:#ffd3d3}
.subtle{color:#9aa3b2;font-size:11px}
.attachments{display:flex;gap:6px;padding:6px 12px;border-top:1px dashed #2a2a35;background:rgba(255,255,255,0.02)}
.attachments.hidden{display:none}
.attachment-chip{display:inline-flex;align-items:center;gap:6px;border:1px solid #2a2a35;border-radius:999px;padding:4px 8px;font-size:12px}
.attachment-chip .rm{background:transparent;border:0;color:#a6a6b3;cursor:pointer}
.userInput{flex:1;background:#0f0f14;border:1px solid #24242c;border-radius:12px;padding:10px 12px;color:var(--text);resize:none;min-height:40px;max-height:300px;overflow:hidden}
.send-btn{background:linear-gradient(135deg,var(--primary),#5b38ff);border:0;border-radius:999px;color:white;padding:0 16px;cursor:pointer;align-self:flex-end;margin-bottom:6px}
.bubble{max-width:78%;min-width:150px;min-height:44px;padding:10px 12px;border-radius:16px;margin:8px 0;background:rgba(255,255,255,0.01);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.08);box-shadow:0 10px 26px rgba(0,0,0,0.35)}
.bubble.user{margin-left:auto;background:rgba(124,92,255,0.02);border-color:rgba(124,92,255,0.22)}
/* Author label above each bubble, aligned with the bubble side */
.panel-flyout .author-label{font-size:12px;color:var(--subtle);margin:0 0 2px 0;padding:0}
/* Message grouping and alignment */
.message-row{display:flex;flex-direction:column}
.message-row.user{align-items:flex-end}
.message-row:not(.user){align-items:flex-start}
/* Ensure author aligns to bubble left by using a fit-content group */
.msg-group{display:flex;flex-direction:column;align-items:flex-start;max-width:78%}
.message-row.user .msg-group{align-items:flex-end}

/* Resize handles */
.flyout-resize{position:absolute;width:14px;height:14px}
.flyout-resize.br{right:6px;bottom:6px;cursor:nwse-resize;background:linear-gradient(135deg,transparent 50%, rgba(124,92,255,.4) 50%);clip-path:polygon(0 100%, 100% 0, 100% 100%);opacity:.6}
.flyout-resize.br:hover{opacity:1}
.flyout-resize.t{top:-2px;left:0;right:0;height:6px;width:auto;cursor:ns-resize;background:transparent}
.flyout-resize.b{bottom:-2px;left:0;right:0;height:6px;width:auto;cursor:ns-resize;background:transparent}
.flyout-resize.l{left:-2px;top:0;bottom:0;width:6px;height:auto;cursor:ew-resize;background:transparent}
.flyout-resize.r{right:-2px;top:0;bottom:0;width:6px;height:auto;cursor:ew-resize;background:transparent}

/* Internet hub style */
.internet-hub{width:48px;height:48px;border-radius:50%;display:grid;place-items:center}
.internet-hub .globe{width:26px;height:26px;filter:drop-shadow(0 2px 10px rgba(124,92,255,0.35))}
.internet-hub.active{box-shadow:0 0 0 2px rgba(0,212,255,0.8), 0 0 36px rgba(0,212,255,0.35)}

/* User Node sizing and label offset */
.user-node.fab{width:56px;height:56px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;background:var(--panel);box-shadow:0 6px 18px rgba(0,0,0,0.25)}
.user-avatar{font-size:22px;line-height:1}
